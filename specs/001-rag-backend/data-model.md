# Data Model: Physical AI RAG Backend

## Entities

### Question
**Description**: A user's query about textbook content
**Fields**:
- `question` (string): The text of the user's question
- `timestamp` (datetime): When the question was submitted
- `session_id` (string, optional): User session identifier

### Answer
**Description**: A response generated by the LLM with citations
**Fields**:
- `answer` (string): The text response from the LLM
- `sources` (list of strings): Citations to specific textbook content
- `chunk_ids` (list of strings): Qdrant vector reference keys
- `timestamp` (datetime): When the answer was generated

### TextSelection
**Description**: A portion of text selected by the user from the textbook
**Fields**:
- `selection` (string): The selected text content
- `question` (string, optional): Additional question about the selected text
- `context` (string): Context around the selected text
- `timestamp` (datetime): When the selection was made

### VectorChunk
**Description**: A chunk of textbook content stored in the vector database
**Fields**:
- `chunk_id` (string): Unique identifier for the chunk
- `content` (string): The text content of the chunk
- `embedding` (list of floats): The vector embedding of the content
- `metadata` (dict): Additional information (source page, chapter, etc.)
- `created_at` (datetime): When the chunk was created

### HealthStatus
**Description**: System health check response
**Fields**:
- `status` (string): Current system status ("ok", "degraded", "error")
- `model` (string): Currently active model identifier
- `timestamp` (datetime): When the status was checked
- `dependencies` (dict): Status of external services (Qdrant, Gemini API)

## Validation Rules

### Question Validation
- Length: 1-1000 characters
- Must not be empty or whitespace only
- Must be related to textbook content (enforced by RAG logic)

### Answer Validation
- Length: Maximum 200 tokens as per constitution
- Must include at least one source citation when content is found
- Must include "No supporting information found in the book" when no relevant content exists

### TextSelection Validation
- Length: Minimum 10 characters (otherwise falls back to normal RAG)
- Maximum 5000 characters to prevent abuse
- Must be actual text from the textbook

## State Transitions

### Question Processing Flow
1. `received` → Input validation
2. `validated` → RAG retrieval process
3. `retrieved` → LLM generation
4. `generated` → Response formatting
5. `completed` → Response returned to user

### Health Check Flow
1. `requested` → Dependency checks
2. `checking` → Status aggregation
3. `completed` → Status response